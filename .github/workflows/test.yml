name: "CI - Test Features"
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test-autogenerated:
    runs-on: ubuntu-latest
    continue-on-error: true
    strategy:
      matrix:
        features:
          - tig
        baseImage:
          - debian:latest
          - ubuntu:latest
          - mcr.microsoft.com/devcontainers/base:ubuntu
    steps:
      - name: "Checkout"
        uses: actions/checkout@v3

      - name: "Test ${{ matrix.features }} against ${{ matrix.baseImage }}"
        uses: devcontainers/ci@v0.3
        with:
          # Change this to point to test scenarios you want to run
          runCmd: |
            set -e
            if [ -f "./test/${{ matrix.features }}/test.sh" ]; then
              cd ./test/${{ matrix.features }}
              chmod +x test.sh
              ./test.sh
            else
              echo "Testing ${{ matrix.features }}..."
              ${{ matrix.features }} --version || ${{ matrix.features }} --help || which ${{ matrix.features }}
            fi
          env: |
            FEATURES=${{ matrix.features }}
          imageName: test-${{ matrix.features }}
          imageVariant: ${{ matrix.baseImage }}

